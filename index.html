<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Nix(OS)</title> <!-- Nix.* -->

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <!-- TODO list:
          - Dependency graphs (demo?)
          - Release process?
          - NixOS security
          - Vulnix
          - NixOS tests (/lib/tests + /nixos/tests)
          - Overlays (demonstration?)
          - Nix 1.12 (see presentation by Eelco Dolstra)
          - Great community!
          - NixCon
          - GNU Guix
          - Show websites:
            - https://hydra.nixos.org/
        -->
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nix(OS) - The Power To Revolutionize!
            <!-- ... packaging and configuration management! -->
            <!-- .element: style="font-size:2em" -->
            <!-- Totally not stolen from @Profpatsch... :D -->

            ![NixOS logo](img/nixos-white.svg)
            <!-- .element style="background:#222;border-style:none;box-shadow:none" -->

            The Purely Functional Linux Distribution
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Main components

            - Nix (package manager)
            - Nixpkgs (Nix packages collection)
            - NixOS (operating system)
            - NixOps (DevOps / cloud deployment tool)
            <!-- TODO: Nix expressions / Nix expression language
              Nix core (store derivations)?
              nixpkgs: /lib
            -->
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nix* ISO/OSI model
            <!-- Yes, we know this hast nothing to do with ISO/OSI... :D -->

            ![Nix* ISO/OSI model](img/nix-iso-osi.svg)
            <!-- .element height="35%" width="35%" style="background:white;border-style:none" -->

          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Other tools

            - Hydra (Nix based continuous build system)
            - Disnix (distributed services deployment)
            - PatchELF (change dynamic linker and RPATH)
            - {cabal,go,node,pip,python,pypi,composer,hex,bower,vim,...}2nix
            Notes:
            - nixcrates, cargo2nix, elm2nix, ...
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # History

            - Started as a **research project** (with funding)
            - First paper in 2004 (many will follow)
            - Nix package manager developed by **Eelco Dolstra** as part of his
              PhD research (~2003)
            - First NixOS prototype developed by Armijn Hemel as his master's
              thesis project
            - Hydra developed as part of the LaQuSo Buildfarm project
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Timeline

            ![Nix project logo](img/nix-snowflake.svg)
            <!-- .element height="30%" width="30%" style="background:#222;border-style:none;box-shadow:none;position:absolute;right:0px;top:0px" -->

            - 2003: init (research begins)
            - 2007: NixOS becomes usable + x86_64 support
            - 2008: Website moved to nixos.org
            - 2009: Nix logo + Nix(OS) build on Hydra
            - 2011: Migration from Subversion to Git(Hub)
            - 2013: Switch from Upstart to systemd + NixOps 1.0 release
            - 2015: NixOS Foundation + First NixCon (Berlin)
            - 2017: Second NixCon (Munich)
            Notes:
            - https://nixos.org/news.html
            - 2007: NixOS is not an
              [April Foolsâ€™ Joke](https://www.osnews.com/comments/17601)
            - Nix logo:
              - Nix is Latin for snow (-> snowflake)
              - Was initially created for the Haskell logo competition
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Problems of classical package managers

            - Different versions of a binary
            - Package conflicts
            - State -> nondeterministic builds -> not reproducible
            - No rollbacks
            - No configuration management (NixOS)
            - Updates/configuration changes destructively update the system
              state (overwriting files in sequence -> temporary inconsistency)
            Notes:
            - Apps might have an undefined behaviour or crash when launched
              during an upgrade + possibility of permanent damage when
              interrupted (e.g. even unbootable!).
            - Incomplete dependency specifications (no isolated build
              environment)
            - Nominal dependency specifications (only name and optionally
              version)
            - Configuration files not controlled by the package manager.
            - Upgrading modified configuration files is problematic.
            - Binaries = global variables (e.g. /bin/bash)
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nix(OS)

            - Atomic upgrades/rollbacks (software & configuration)
            - Multiple versions of a package (side-by-side, e.g. testing a new
              Apache version)
            - Deterministic & Reproducible builds
            - Reliable upgrades (and rollbacks - configuration bound to correct
              software version + service reloads/restarts)
            - Reliable channel upgrades/rollbacks (e.g. 17.03 -> 17.09)
            - Unprivileged users can securely install software
            Notes:
            - Next slide: Declarative configuration management
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Being functional

            - Classically: Imperative configuration
              - Stateful changes (-> dependency hell, inconsistent states, etc.)
            - NixOS: Declarative configuration
              - Packages/Configuration = immutable values
              - (Complete) rebuilds instead of destructive updates
              - Referential transparency (~an expression always evaluates to the
                same result)
            Notes:
            - Referential transparency: An expression always evaluates to the
              same result in any contex (no side effects like (uncontrolled)
              imperative updates).
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Problems

            - Not all packages are reproducible (2016: 12.8%)
            - Running pre-compiled binaries
            - No GUI for package/configuration management
            - No LTS releases or super stable (i.e. old :P) branches
            - Not all use-cases or configuration options supported
              - Some tricks available + PRs welcome ;)
            - Lacking manpower/workforce (e.g. security, documentation)
            - Scripts with hard-coded paths don't work
            Notes:
            - 13 Dec 2016: "Currently, out of 36550 build steps in a full NixOS
            evaluation, only 4699 (12.8%) were detected as non-deterministic.
            (Note that Hydra can only detect the presence of non-determinism,
            not its absence)." - Eelco
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nix

            - A purely functional package manager (transparent source/binary
              deployment)
            - Secure multi-user support
            - Stores packages in the Nix store (`/nix/store` by default)
            - Each package has it's own unique identifier/directory
              - E.g. `qn96dbgqdryaw38zw6v08da34q5v4qz3-git-repo-1.12.37`
                <!-- .element: style="font-size:0.7em" -->
                (cryptographic hash, name, version)
              - Enables multiple versions & binary substitutes
              - "Forces" complete dependencies
            Notes:
            - Hash captures all dependencies (160-bit truncations of SHA-256
              encoded in base-32 (i.e. 32 characters))
            - Version: Digit after a dash
            - Garbage collection (nix-collect-garbage)
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nix expressions / Nix expression language

            - A DSL (not a GPL!)
              - Describes graphs of build actions ("derivations")
              - Packages, compositions of packages, configurations, ...
            - Dynamically typed ("Nix won't be complete until it has static
              typing." @edolstra) - https://typing-nix.regnat.ovh/
            - Lazy (a very important feature!)
            - Purely functional (no side-effects, immutable store)
            - Turing complete (e.g. Dhall is not ->
              [dhall-nix](https://github.com/dhall-lang/dhall-nix))
            Notes:
            - DSL vs GPL: MD5 collisions by @Azlig (Chromium updater) :D
            - "Config files shouldn't be Turing complete" (-> always terminate)
            - Dhall is explicitly typed, evaluated, and configuration files can
              be reduced to a normal form
            <!-- TODO:
              - Bad evaluation errors? :D
                - Missing typing
                - Error in anonymous function at unknown file?
              - Evaluated vs interpreted?
              - Bugs? :D (e.g. a-b)
            -->
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # nix-repl

            - **Demo** <!-- TODO -->
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nixpkgs (the Nix packages collection)
            <!-- .element: style="font-size:1.6em" -->

            - Main GitHub repository (permissive MIT/X11 license)
            - Contains definitions of packages (Nix) and modules (NixOS)
            - Also contains tests, library functions, etc.
            - Different branches (rolling: master, stable: release-YY.MM)
            - Build and tested by Hydra (+ uploaded to binary cache)
            - Distributed through (nixpkgs-)channels (nixpkgs-unstable,
              nixos-unstable(-small), nixos-YY.MM(-small))
            Notes:
            - Stable: MM = 03 or 09 (end of month, branch off one month before)
            - Talk about codenames, release schedule, freezing, etc.?
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # An example Nix package (pgpdump) <!-- .element: style="font-size:1.5em" -->

            ```nix
            pgpdump = callPackage ../tools/security/pgpdump { };
            ```

            ```nix
            { stdenv, fetchFromGitHub
            , supportCompressedPackets ? true, zlib, bzip2
            }:

            stdenv.mkDerivation rec {
              name = "pgpdump-${version}";
              version = "0.32";

              src = fetchFromGitHub {
                owner = "kazu-yamamoto";
                repo = "pgpdump";
                rev = "v${version}";
                sha256 = "1ip7q5sgh3nwdqbrzpp6sllkls5kma98kns53yspw1830xi1n8xc";
              };

              buildInputs = stdenv.lib.optionals supportCompressedPackets [ zlib bzip2 ];

              meta = with stdenv.lib; {
                description = "A PGP packet visualizer";
                longDescription = ''
                  pgpdump is a PGP packet visualizer which displays the packet format of
                  OpenPGP (RFC 4880) and PGP version 2 (RFC 1991).
                '';
                homepage = http://www.mew.org/~kazu/proj/pgpdump/en/;
                license = licenses.bsd3;
                platforms = platforms.linux;
                maintainers = with maintainers; [ primeos ];
              };
            }
            ```
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # nix-env (manipulate or query Nix user environments)
            <!-- .element: style="font-size:1.13em" -->

            ![User environments](img/user-environments.png)

            https://nixos.org/nix/manual/figures/user-environments.png
            <!-- .element: style="font-size:0.5em" -->
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # nix-shell

            - **Demo** <!-- TODO -->
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # NixOS

            - Implements a declarative and purely functional system
              configuration model
            - Based on Nix (package + configuration management)
            - NixOS modules (separation of concerns)
            - Form the full "system configuration"
              ```nix
              { config, pkgs, ... }: {
                options = { nested attribute set of option declarations using mkOption };
                config = { nested attribute set of option definitions };
              }
              ```
            Notes:
            - modules = functions
            - { config } -> config = full system configuration
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # An example NixOS module <!-- .element: style="font-size:1.5em" -->

            ```nix
            { config, lib, pkgs, ... }:

            with lib;

            let
              cfg = config.programs.vim;
            in {
              options.programs.vim = {
                defaultEditor = mkOption {
                  type = types.bool;
                  default = false;
                  description = ''
                    When enabled, installs vim and configures vim to be the default editor
                    using the EDITOR environment variable.
                  '';
                };
              };

              config = mkIf cfg.defaultEditor {
                    environment.systemPackages = [ pkgs.vim ];
                    environment.variables = { EDITOR = mkOverride 900 "vim"; };
              };
            }

            ```
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # An example NixOS configuration <!-- .element: style="font-size:1.5em" -->
            <!-- TODO: More awesome stuff? :) -->

            ```nix
            { config, pkgs, ... }:

            {
              system.stateVersion = "17.09";

              nix.useSandbox = true;

              boot.kernelPackages = pkgs.linuxPackages_latest;

              i18n = {
                consoleFont = "Lat2-Terminus16";
                consoleKeyMap = "de";
                defaultLocale = "en_US.UTF-8";
              };

              time.timeZone = "Europe/Berlin";

              environment = {
                systemPackages = with pkgs; [
                  # Core
                  vim_configurable gitAndTools.gitFull wget
                  # Monitoring
                  htop python3Packages.glances
                  # Tools
                  time file tree lsof
                  pciutils hdparm zip unzip
                  # Network
                  inetutils bind.dnsutils
                  tcpdump
                ];
                variables = {
                  EDITOR = "vim";
                };
              };

              programs.bash.enableCompletion = true;
            }
            ```
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # NixOps

            - **Demo** <!-- TODO -->
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nixpkgs overlays
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # NixUP & co.
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Learning

            - [Learn X in Y minutes, where X=nix](https://learnxinyminutes.com/docs/nix/)
            - [A tour of Nix](https://nixcloud.io/tour/)
              - By Joachim Schiele & Paul Seitz from TÃ¼bingen ;)
          </textarea>
        </section>
        <section data-markdown data-separator-notes="^Notes:">
          <textarea data-template>
            # Nix Pills

            - A ported version of the Nix Pills (a series of blog posts)
            - A tutorial introduction into the Nix package manager and Nixpkgs package collection
            - In the form of short chapters called 'pills'
            - https://nixos.org/nixos/nix-pills/
          </textarea>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ],
        width: 1080,
        height: 720
      });
    </script>
  </body>
</html>
